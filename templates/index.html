<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <!-- Bootstrap CSS -->
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
            integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
            crossorigin="anonymous"
        />
        <title>Live Streaming</title>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <!-- 타이틀과 영상을 보여주는 곳 -->
                <div class="col-lg-8 offset-lg-2">
                    <h3 class="mt-5">Smart CCTV Streaming</h3>
                    <img src="{{ url_for('video_feed') }}" width="100%" />
                </div>

                <!-- 버튼 액션 폼 -->
                <div class="col-lg-8 offset-lg-2">
                    <h3 class="mt-5">플라스크 버튼</h3>
                    <form method="post" action="/result">
                        <!-- 녹화 시작 및 종료 -->
                        {% if rec == false %}
                        <input type="submit" value="녹화시작" name="button" onclick="record_start()" />
                        {% else %}
                        <input type="submit" value="녹화종료" name="button" />
                        <span id="clock" style="color: gray"></span>
                        {% endif %}
                        <!-- 사진 캡쳐 -->
                        <input type="submit" value="캡쳐" name="button" />
                        <!-- 예약 녹화 -->
                        <input type="submit" value="예약녹화" name="button" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // 녹화 시작 이벤트
            function record_start() {
                const startTimeOfRecord = Date.now();
                sessionStorage.setItem("startTimeOfRecord", startTimeOfRecord);
            }

            // 녹화에 소요되는 시간 시각화
            function clock() {
                const Target = document.getElementById("clock");
                const startTimeOfRecord = parseInt(sessionStorage.getItem("startTimeOfRecord"));

                const recordingTime = new Date();
                const hours = parseInt((recordingTime - startTimeOfRecord) / 1000 / 60 / 60);
                const minutes = parseInt((recordingTime - startTimeOfRecord) / 1000 / 60);
                const seconds = parseInt((recordingTime - startTimeOfRecord) / 1000);

                Target.innerText = `${hours > 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${
                    seconds < 10 ? `0${seconds}` : seconds
                }`;
            }
            clock();
            setInterval(clock, 1000); // 1초마다 실행
        </script>
    </body>
</html>
